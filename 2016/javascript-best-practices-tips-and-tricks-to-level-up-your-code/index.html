<!DOCTYPE html><html lang=zh-cn><head><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><title>JavaScript 最佳实践: 提升你代码质量的一些提示&技巧 · 云淡风轻</title><meta name=description content="JavaScript 最佳实践: 提升你代码质量的一些提示&amp;技巧 - 云淡风轻"><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="short icon" type=image/x-icon href=/images/favicon.ico><link rel=stylesheet href=/scss/apollo.css><link rel=stylesheet href=//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css><!--[if lt IE 9]><script src="/scripts/html5shiv/html5shiv.min.js"></script><script src="/scripts/html5shiv/html5shiv-printshiv.min.js"></script><![endif]--><link rel=search type=application/opensearchdescription+xml href=http://ioliu.cn/atom.xml title=云淡风轻></head><body><div class=wrap><header><a href="/" class=logo-link><img src=/images/favicon.png></a><ul class="nav nav-list"><li class=nav-list-item><a href="/" target=_self class=nav-list-link>Home</a></li><li class=nav-list-item><a href="/archives/" target=_self class=nav-list-link>Archive</a></li><li class=nav-list-item><a href="/tags/" target=_self class=nav-list-link>Tags</a></li><li class=nav-list-item><a href=http://weibo.com/1842336184 target=_blank class=nav-list-link>Weibo</a></li><li class=nav-list-item><a href=https://github.com/xcss target=_blank class=nav-list-link>GitHub</a></li><li class=nav-list-item><a href=/atom.xml target=_self class=nav-list-link>Rss</a></li></ul></header><section class=container><div class=post><article class=post-block><h1 class=post-title>[译] JavaScript 最佳实践: 提升你代码质量的一些提示&技巧</h1><div class=post-info>2016年9月2日<a href="/tags/JavaScript/" title=JavaScript class=post-tag>#JavaScript</a><a href="/tags/前端/" title=前端 class=post-tag>#前端</a><a href="/tags/译文/" title=译文 class=post-tag>#译文</a><a href="/tags/技巧/" title=技巧 class=post-tag>#技巧</a><span id="/2016/javascript-best-practices-tips-and-tricks-to-level-up-your-code/" title="JavaScript 最佳实践: 提升你代码质量的一些提示&amp;技巧" class=leancloud-visitors>-°</span><div class=cp-tip><div class=cp-scroll-x><p class=cp-author>原文作者:<a href=https://www.codementor.io/johnnyb title=@johnnyb target=_blank>@johnnyb</a></p><p class=cp-url>原文地址:<a href=https://www.codementor.io/javascript/tutorial/javascript-best-practices title=https://www.codementor.io/javascript/tutorial/javascript-best-practices target=_blank>https://www.codementor.io/javascript/tutorial/javascript-best-practices</a></p><p class=cp-post>中文翻译:<a href=https:github.com/xcCss title=云淡风轻 target=_blank>云淡风轻</a></p><p class=cp-post-url>译文地址:<a href="http://ioliu.cn/2016/javascript-best-practices-tips-and-tricks-to-level-up-your-code/" title="http://ioliu.cn/2016/javascript-best-practices-tips-and-tricks-to-level-up-your-code/" target=_blank>http://ioliu.cn/2016/javascript-best-practices-tips-and-tricks-to-level-up-your-code/</a></p><p class=cp-note>本文由 @云淡风轻 翻译，转载请保留此声明。</p><p class=cp-note>著作权属于原作者，请勿用作商业用途。</p></div></div></div><div class=post-content><p><img src=/images/placeholder.gif data-orig=https://ws4.sinaimg.cn/large/006qRazegw1f7f8plb62gj30p00cimxw.jpg alt=""></p><p>每天学习新事物是成为一个伟大的人的一部分。而对开发者而言，持续不断学习新的东西是我们工作中的一部分，无论这些东西是否是你主动想学的。</p><p>在本教程中，我会指出一些重要的 JavaScript 最佳实践，因此你不必觉得学习它是条艰难的路。准备提升你的代码吧！<br><a id=more></a></p><h2 id=避免全局污染-Avoid-polluting-the-global-scope><a href=#避免全局污染-Avoid-polluting-the-global-scope class=headerlink title="避免全局污染(Avoid polluting the global scope)"></a>避免全局污染(Avoid polluting the global scope)</h2><p>声明变量(<code>Declaring variables</code>)是很有趣的。有时候，你可能声明了全局变量，即使你不想声明它。在如今的浏览器中，全局变量存储在<code>window</code>对象中。因此，有很多有趣的东西发生在那里，你可能会重写默认值。<br>让我们假设你有一个HTML文件，其中包含一个<code>&lt;script&gt;</code>标签(或者在加载的 JavaScript 文件中包含):<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=keyword>var</span> foo = <span class=number>42</span>;</div><div class=line><span class=built_in>console</span>.log(foo);</div></pre></td></tr></table></figure></p><p>这很显然会在控制台输出<code>42</code>。但是，因为这段代码没有在函数中执行，上下文将是一个全局的。因此，变量是附加到<code>window</code>对象的。这意味着<code>window.foo</code>的值也是<code>42</code>。</p><p>这是危险的，因为你可以重写已经存在的全局变量:<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>print</span>(<span class=params></span>)</span>&#123;</div><div class=line>	<span class=comment>//do something...</span></div><div class=line>&#125;</div><div class=line></div><div class=line>print();</div></pre></td></tr></table></figure></p><p>因为我们重写了原生的打印弹窗(<code>native print popup</code>)，所以当我们执行<code>window.print()</code> (或者只执行<code>print()</code>)的时候不会打开打印弹窗(<code>print popup</code>)。</p><p>这个问题很好解决，我们需要一个立即调用(<code>called immediately</code>) 的包装函数(<code>wrapping function</code>) (译者注:作者这里可能是要表达一个闭包函数<code>closure function</code>或者是匿名函数<code>anonymous function</code>)，像下面的代码:<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=comment>// Declare an anonymous function</span></div><div class=line><span class=comment>// 声明一个匿名函数</span></div><div class=line>(<span class=function><span class=keyword>function</span> (<span class=params></span>) </span>&#123;</div><div class=line>   <span class=keyword>var</span> foo = <span class=number>42</span>;</div><div class=line>   <span class=built_in>console</span>.log(<span class=built_in>window</span>.foo);</div><div class=line>   <span class=comment>// → undefined</span></div><div class=line>   <span class=built_in>console</span>.log(foo);</div><div class=line>   <span class=comment>// → 42</span></div><div class=line>&#125;)();</div><div class=line><span class=comment>//^ and call it immediately</span></div></pre></td></tr></table></figure></p><p>另外，你应该选择发送<code>window</code>和其他的全局变量(如:<code>document</code>)作为函数的参数(这可能会提高性能):<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line>(<span class=function><span class=keyword>function</span> (<span class=params>global, doc</span>) </span>&#123;</div><div class=line>  global.setTimeout(<span class=function><span class=keyword>function</span> (<span class=params></span>) </span>&#123;</div><div class=line>     doc.body.innerHTML = <span class=string>"Hello!"</span>;</div><div class=line>  &#125;, <span class=number>1000</span>);</div><div class=line>&#125;)(<span class=built_in>window</span>, <span class=built_in>document</span>);</div></pre></td></tr></table></figure></p><p>因此，使用包装函数来防止创建不必要的全局变量。注意，这不是说我在接下来的代码片段使用包装函数，我们应该把关注点放在代码本身。</p><blockquote><p>💡小提示: <a href="http://browserify.org/" target=_blank rel=external>browserify</a>是另外一种防止创建不必要的全局变量的方式。它和 Node.js 采用的是同样的方式，使用的<code>require function</code>。</p></blockquote><hr><p><em>学习更多关于浏览器开发者工具请点击 <a href=https://www.codementor.io/learn-development/javascript-css-html-tutorial-front-end-development-tools target=_blank rel=external>Web 开发指南</a></em></p><hr><p>顺便说一句，Node.js 会在函数里自动打包你的文件，它们看起来像这样：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line>(<span class=function><span class=keyword>function</span> (<span class=params>exports, require, module, __filename, __dirname</span>) </span>&#123;</div><div class=line><span class=comment>// ...</span></div></pre></td></tr></table></figure></p><p>因此，如果这让你认为<code>require</code>函数是全局的那就错了。它只不过是一个函数的参数罢了。</p><p><strong>你知道吗？</strong><br>由于<code>window</code>对象本身就是一个包含全局变量的全局变量，因此它的引用是自身:<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=built_in>window</span>.window.window</div><div class=line><span class=comment>// =&gt; Window &#123;...&#125;</span></div></pre></td></tr></table></figure></p><p>那是因为<code>window</code>对象是一个环路对象(<code>circular object</code>)，下面演示怎么创建一个这样的对象：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=comment>// Create an Object</span></div><div class=line><span class=keyword>var</span> foo = &#123;&#125;;</div><div class=line></div><div class=line><span class=comment>// Point a key value to the object itself</span></div><div class=line><span class=comment>// 设置一个key，值为它本身</span></div><div class=line>foo.bar = foo;</div><div class=line></div><div class=line><span class=comment>// The `foo` object just became a circular one:</span></div><div class=line>foo.bar.bar.bar</div><div class=line><span class=comment>// → foo</span></div></pre></td></tr></table></figure></p><p>或者，去展现你对JavaScript 的爱，你可以做得更好：<br><img src=/images/placeholder.gif data-orig=https://ws1.sinaimg.cn/large/006qRazegw1f7fbn6xey4j30di0ca409.jpg alt=""><br>Yes，你可以无限的扩展这个对象(大概直到你的浏览器崩溃).</p><h2 id=使用严格模式-use-strict><a href=#使用严格模式-use-strict class=headerlink title="使用严格模式(use strict)"></a>使用严格模式(<code>use strict</code>)</h2><p>严格的使用<code>use strict</code>！这只不过是(译者注:这里原作者可能是想表达<code>不仅仅是</code>)在你的代码脚本中添加字符串而已。<br>举个栗子：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=comment>// This is bad, since you do create a global without having anyone to tell you</span></div><div class=line>(<span class=function><span class=keyword>function</span> (<span class=params></span>) </span>&#123;</div><div class=line>   a = <span class=number>42</span>;</div><div class=line>   <span class=built_in>console</span>.log(a);</div><div class=line>   <span class=comment>// → 42</span></div><div class=line>&#125;)();</div><div class=line><span class=built_in>console</span>.log(a);</div><div class=line><span class=comment>// → 42</span></div></pre></td></tr></table></figure></p><p>使用<code>use strict</code>，你可以得到更多的确切的错误：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line>(<span class=function><span class=keyword>function</span> (<span class=params></span>) </span>&#123;</div><div class=line><span class=meta>   "use strict"</span>;</div><div class=line>   a = <span class=number>42</span>;</div><div class=line>   <span class=comment>// Error: Uncaught ReferenceError: a is not defined</span></div><div class=line>&#125;)();</div></pre></td></tr></table></figure></p><p>你可能会奇怪，为什么不能将<code>use strict</code> 写在函数体外。当然，这是可以的，但它将会应用为全局的范围。这仍然是不错的，但如果你的代码中含有来自其他库的代码，这也会受其影响，或者你把所有的东西都绑定在一个文件里。</p><h2 id=严格相等-Strict-equal><a href=#严格相等-Strict-equal class=headerlink title="严格相等(Strict equal)"></a>严格相等(<code>Strict equal</code>)</h2><p>这是短的。如果你使用<code>==</code>对比<code>a</code>和<code>b</code>(像在其他编程语言)，在 JavaScript 中，你可能这种非常奇怪的运行方式：如果你有一个字符串和一个数字，他们是相等的(<code>==</code>):<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=string>"42"</span> == <span class=number>42</span></div><div class=line><span class=comment>// → true</span></div></pre></td></tr></table></figure></p><p>由于显而易见的原因(如 <code>验证(validations)</code>)，最好使用严格相等(<code>===</code>)：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=string>"42"</span> === <span class=number>42</span></div><div class=line><span class=comment>// → false</span></div></pre></td></tr></table></figure></p><h2 id=使用断言-amp-amp><a href=#使用断言-amp-amp class=headerlink title=使用断言(&amp;&amp;/||)></a>使用断言(<code>&amp;&amp;</code>/<code>||</code>)</h2><p>根据你的需要，你可以使用逻辑运算符是你的代码更简短。<br><strong>默认值:</strong></p><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=string>""</span> || <span class=string>"foo"</span></div><div class=line><span class=comment>// → "foo"</span></div><div class=line></div><div class=line><span class=literal>undefined</span> || <span class=number>42</span></div><div class=line><span class=comment>// → 42</span></div><div class=line></div><div class=line><span class=comment>// Note that if you want to handle 0 there, you need</span></div><div class=line><span class=comment>// to check if a number was provided:</span></div><div class=line><span class=keyword>var</span> a = <span class=number>0</span>;</div><div class=line>a || <span class=number>42</span></div><div class=line><span class=comment>// → 42</span></div><div class=line></div><div class=line><span class=comment>// This is a ternary operator—works like an inline if-else statement</span></div><div class=line><span class=keyword>var</span> b = <span class=keyword>typeof</span> a === <span class=string>"number"</span> ? a : <span class=number>42</span>;</div><div class=line><span class=comment>// → 0</span></div></pre></td></tr></table></figure><p>检查是否是一个真正的<code>if</code>表达式，你可以简单的这么做：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line>expr &amp;&amp; doSomething();</div><div class=line></div><div class=line><span class=comment>// Instead of:</span></div><div class=line><span class=keyword>if</span> (expr) &#123;</div><div class=line>	doSomething();</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>你可能会不赞同我这里的写法，但是这是比较理想的。如果你不想用这种方式丑化你的代码，但那些 JavaScript 压缩工具实际上会这么做。</p><p>如果你问我，尽管这些代码比较短，但它仍然是人类可读的。</p><h2 id=类型转换><a href=#类型转换 class=headerlink title=类型转换></a>类型转换</h2><p>有几种方式来转换这些东西，这取决于你想怎么做。最常见的方式是：<br><figure class="highlight js"><table><tr><td class=code><pre><div class=line><span class=comment>// From anything to a number</span></div><div class=line></div><div class=line><span class=keyword>var</span> foo = <span class=string>"42"</span>;</div><div class=line><span class=keyword>var</span> myNumber = +foo; <span class=comment>// shortcut for Number(foo)</span></div><div class=line><span class=comment>// → 42</span></div><div class=line></div><div class=line><span class=comment>// Tip: you can convert it directly into a negative number</span></div><div class=line><span class=keyword>var</span> negativeFoo = -foo; <span class=comment>// or -Number(foo)</span></div><div class=line><span class=comment>// → -42</span></div><div class=line></div><div class=line><span class=comment>// From object to array</span></div><div class=line><span class=comment>// Tip: `arguments` is an object and in general you want to use it as array</span></div><div class=line><span class=keyword>var</span> args = &#123; <span class=number>0</span>: <span class=string>"foo"</span>, <span class=number>1</span>: <span class=string>"bar"</span>, <span class=attr>length</span>: <span class=number>2</span> &#125;;</div><div class=line><span class=built_in>Array</span>.prototype.slice.call(args)</div><div class=line><span class=comment>// → [ 'foo', 'bar' ]</span></div><div class=line></div><div class=line><span class=comment>// Anything to boolean</span></div><div class=line><span class=comment>/// Non non p is a boolean p</span></div><div class=line><span class=keyword>var</span> t = <span class=number>1</span>;</div><div class=line><span class=keyword>var</span> f = <span class=number>0</span>;</div><div class=line>!!t</div><div class=line><span class=comment>// → true</span></div><div class=line>!!f</div><div class=line><span class=comment>// → false</span></div><div class=line></div><div class=line><span class=comment>/// And non-p is a boolean non-p</span></div><div class=line>!t</div><div class=line><span class=comment>// → false</span></div><div class=line>!f</div><div class=line><span class=comment>// → true</span></div><div class=line></div><div class=line><span class=comment>// Anything to string</span></div><div class=line><span class=keyword>var</span> foo = <span class=number>42</span>;</div><div class=line><span class=string>""</span> + foo <span class=comment>// shortcut for String(foo)</span></div><div class=line><span class=comment>// → "42"</span></div><div class=line></div><div class=line>foo = &#123; <span class=attr>hello</span>: <span class=string>"world"</span> &#125;;</div><div class=line><span class=built_in>JSON</span>.stringify(foo);</div><div class=line><span class=comment>// → '&#123; "hello":"world" &#125;'</span></div><div class=line></div><div class=line><span class=built_in>JSON</span>.stringify(foo, <span class=literal>null</span>, <span class=number>4</span>); <span class=comment>// beautify the things</span></div><div class=line><span class=comment>// →</span></div><div class=line><span class=comment>// '&#123;</span></div><div class=line><span class=comment>//    "hello": "world"</span></div><div class=line><span class=comment>// &#125;'</span></div><div class=line></div><div class=line><span class=comment>// Note you cannot JSON.stringify circular structures</span></div><div class=line><span class=built_in>JSON</span>.stringify(<span class=built_in>window</span>);</div><div class=line><span class=comment>// ⚠ TypeError: JSON.stringify cannot serialize cyclic structures.</span></div></pre></td></tr></table></figure></p><h2 id=代码样式-样式指南><a href=#代码样式-样式指南 class=headerlink title=代码样式/样式指南></a>代码样式/样式指南</h2><p>在新项目中，遵循整个文件相同的代码风格。对于现有的，采用已经存在的代码风格，除非你只是决定改变它(提示：同你的合作者商讨)。即使你创建并记录你的代码风格，请始终遵循它。</p><p>这里是不同的现有的代码样式：</p><ul><li><a href=https://google.github.io/styleguide/javascriptguide.xml target=_blank rel=external>Google JavaScript Style Guide</a></li><li><a href=https://github.com/airbnb/javascript target=_blank rel=external>airbnb/javascript</a></li><li>… there are others too</li><li><a href=https://github.com/IonicaBizau/code-style target=_blank rel=external>my style guide</a></li></ul><h2 id=附加提示><a href=#附加提示 class=headerlink title=附加提示></a>附加提示</h2><p>其他重要的 JavaScript 最佳实践，你应该记住的是使用工具帮助你格式化你的代码。这是其中的一些：</p><ul><li><a href=https://github.com/beautify-web/js-beautify target=_blank rel=external>js-beautify</a>: Beautifies your code</li><li><a href=https://github.com/mishoo/UglifyJS2 target=_blank rel=external>UglifyJS(2)</a>: Uglifies/minimifies your code</li><li><a href=https://github.com/jshint/jshint target=_blank rel=external>jshint</a>: Detects errors/potential problems in your JavaScript code</li><li><a href="http://jscs.info/" target=_blank rel=external>jscs</a>: A configurable style guide checker</li></ul><p>最后一件事：<a href=https://www.codementor.io/learn-programming/what-to-do-when-your-website-is-broken target=_blank rel=external>Debug your Code</a></p><p>Happy programming!</p><hr><p>致谢：<a href=https://www.haomwei.com target=_blank rel=external>@屠夫</a> 、<a href=https://qistchan.com target=_blank rel=external>@QistChan</a>、<a href=https://napolin.cn target=_blank rel=external>@nApolin</a>、<a href=http://www.antzone.cn target=_blank rel=external>@Ant</a></p><hr></div></article></div></section><footer><div class=paginator><a href="/2016/css-content-and-special-characters/" class=prev>上一篇</a><a href="/2016/vuejs-examples/" class=next>下一篇</a></div><div data-thread-key="2016/javascript-best-practices-tips-and-tricks-to-level-up-your-code/" data-title="JavaScript 最佳实践: 提升你代码质量的一些提示&amp;技巧" data-url="http://ioliu.cn/2016/javascript-best-practices-tips-and-tricks-to-level-up-your-code/" data-author-key=1 class=ds-thread></div><script>var duoshuoQuery={short_name:"ioliu"};!function(){var t=document.createElement("script");t.id="duoshuo-script",t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//dn-ds-img.qbox.me/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}();</script><script>window.CONFIG={duoshuo:{userId:"ioliu",anthor:"云淡风轻"}};</script><div class=copyright><p>© 2013 - 2017 <a href=http://ioliu.cn>云淡风轻</a>, <a href="http://www.miitbeian.gov.cn/" rel=nofollow target=_blank>粤ICP备15050037号</a> .</p><p>Powered By <a href="https://hexo.io/" rel=nofollow target=_blank>Hexo</a> and <a href=https://github.com/pinggod/hexo-theme-apollo rel=nofollow target=_blank>hexo-theme-apollo</a></p></div></footer></div><script src="/scripts/ua-parser.min.js?v=0.7.9"></script><script src=/scripts/hook-duoshuo.js></script><script src=/scripts/visibility.js></script><script src=/scripts/lazy.js></script><script>echo.lazyAttr="data-orig";</script><script>echo.init({offsetBottom:400,throttle:200,unload:!0,callback:function(t,e){}}),document.addEventListener("DOMContentLoaded",function(){echo.render()},!1);</script><script>/^http:\/\/localhost/.test(location.href)||/_@_@_@=#\$#\$#\$/.test(document.cookie)||(!function(e,t,a,o,n,c){e.GoogleAnalyticsObject=o,e[o]||(e[o]=function(){(e[o].q=e[o].q||[]).push(arguments)}),e[o].l=+new Date,n=t.createElement(a),c=t.getElementsByTagName(a)[0],n.src="https://www.google-analytics.com/analytics.js",c.parentNode.insertBefore(n,c)}(window,document,"script","ga"),ga("create","UA-61934506-1","auto"),ga("send","pageview"));</script><script>if(!/^http:\/\/localhost/.test(location.href)){var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?2119376191e432c012a0713bcca8a8ea";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}</script><script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js></script><script src=/scripts/lean-analytics.js></script><script>AV.initialize("R9cQjqaD9AXPKY7AQiU6U6yl","YHUU5n9sbvpRQCdiIU8aRsmH");</script></body></html>